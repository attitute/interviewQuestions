
# 构建DOM树：

    原因： 浏览器无法直接理解和使用HTML，所以才需要将HTML转换为浏览器能够理解的结构-DOM树

1.分词

    将html文档进行分词处理，划分为最小的token

```HTML
    <html>
        <body>
            <div>
                dom树
            </div>
        </body>
    </html>
    <!-- 解析成 
        StartTag: html
        StartTag: body
        StartTag: div
        Text: dom树
        EndTag: div
        EndTag: body
        EndTag: html 
    -->
```
2.构建DOM树

    · 解析器会维护一个解析栈，栈底为Document，上述的token依次加入栈顶（text文本除外）
    · startTag加入栈顶时会生成DOM节点，并插入父节点。
    · Text会直接插入到父节点
    · 遇到EndTag，检测栈有无对应StartTag,之后StartTag出栈表明该节点构建完毕
    · 直到EndTag: html解析完毕，DOM树解析完成

3.script标签问题

    当解析器碰到script标签时会停止DOM，运行script脚本，所以会阻塞DOM解析，

    解决方案：
    script添加aync或defer。JavaScript会异步运行不影响DOM解析。

    · defer：先下载，DOM解析渲染完成defer脚本加载完成按顺序执行
    · async: 先下载，下载后立即执行。脚本对DOM无依赖时才能使用

4.CSS样式与DOM阻塞

    css样式文件会以阻塞JS执行的方式，间接阻塞DOM树的构建。

    · 构建DOM树的同时，浏览器会构建样式规则
    · js代码执行前都会进行css文件的下载，解析，再执行JS