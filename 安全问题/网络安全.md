
## HTTPS
    https并不是一个新的协议，只是在http与tcp之间添加了安全层，

    安全层不会对tcp与http本身造成影响

## 安全层
    1. 对发起http请求的数据进行加密操作
    2. 对接收到http的内容进行解密操作。


## 对称加密

    1. 浏览器将加密套件列表和一个随机数client-random发送给服务器
    2. 服务器从浏览器加密套件选择一个，生成随机数service-random，并发送给浏览器
    3. 浏览器服务器都有了彼此的随机数与相同的加密方法。
    4. 随机数混合生成一个密匙，有了密匙与加密方法就可以传输了

    缺点： 攻击者能拦截浏览器服务器的随机数与加密方法，随机数合成密匙的算法是公开的，黑客拿到后可以直接获取密匙，用加密方法直接解密

## 非对称加密

    非对称加密有两个密匙，公钥和私匙。
    公钥只能解密私匙， 私匙也只能解密公匙

    1. 浏览器将加密套件列表发送给服务器
    2. 服务器将加密方法与公匙发送给浏览器
    3. 浏览器通过公匙进行加密发送数据给服务器
    4. 服务器接收到数据通过私匙进行解密
    5. 服务器是通过私匙进行加密发送给浏览器，浏览器用公匙进行解密

    缺点：
        1.非对称加密效率很低，影响用户打开页面
        2.公匙和加密方法是攻击者能获取的，攻击者能获取到公匙与加密方法解密服务器发送给浏览器的内容。


## 非对称加密+对称加密混合使用

    只使用非对称加密一次。主要是传送对称加密的第一次密匙
    ---非对称加密---
    1. 浏览器发送对称与非对称加密套件 和 client-random给服务器
    2. 服务器发送对称与非对称加密套件 和 service-randonm、公匙给浏览器 
    3. 浏览器使用 client-random和service-random 计算生成 pre-master。
    4. 浏览器再使用非对称加密公匙与pre-master生成 x密匙 发送给服务器
    5. 服务器使用非对称加密，通过私匙解密x密匙得到pre-master密匙。

    ---服务器确定收到了 后续操作使用对称加密---
    6. 服务器再使用对称加密，通过pre-master + client-random + service-random 生成密匙 加密传送数据给浏览器
    7. 浏览器使用对称加密，通过pre-master + client-random + service-random 生成密匙 解密传送来的信息
    8. 之后浏览器与服务器 通过对称加密传输数据，对称加密密匙通过pre-master + client-random + service-random 生成密匙无人可知。


## 数字证书

    数字证书的申请：
        
        1. 公司准备一套公匙与私匙， 私匙留着自己用
        2. 公司向CA机构提交公匙、公司、站点等信息认证
        3. CA通过线上线下验证提交信息的真实性
        4. 验证通过，CA会向公司签发认证的数字证书（包括公匙、组织信息、CA信息、有效时间、证书序号等）同时包含一个CA生成的签名

    浏览器如何验证数字证书：

        1. 获取到证书信息浏览器使用CA相同的hash函数计算得到信息摘要A
        2. 利用对应CA的公匙解密签名数据，得到信息B
        3. 信息A与信息B进行比较 如果一致那么证书合法
        4. 浏览器还会验证证书的相关域名信息、有效时间等

        验证CA是谁：

            1. 浏览器会内置信任的顶级CA的证书信息（包括公钥）
            2. 如果在CA中找不到浏览器内置的顶级CA,那么证书会判定违法

             CA 可能比较小众，浏览器不知道该不该信任它，然后浏览器会继续查找给这个 CA 颁发证书的 CA，再以同样的方式验证它上级 CA 的可靠性

    数字证书如果被中间人获取： client向servers发送公钥加密的信息 如果servers不能够进行解密或者用私钥进行加密传回给client，代表是中间人